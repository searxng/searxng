import{a as e,t}from"../sxng-core.min.js";import{t as n}from"./gZqIRpW1.min.js";var r=class extends e{constructor(){super(`quickSummary`)}async run(){let e=n(`quick_summary`);if(!e||!e.querySelector(`.quick-summary-body`))return!1;let r=document.querySelector(`#q`)?.value?.trim(),i=window.quick_summary_max_results||10,a=Array.from(document.querySelectorAll(`#urls article.result`)).slice(0,i);if(!r||a.length===0)return!1;let o=a.map((e,t)=>({index:t,title:e.querySelector(`.result_title a`)?.textContent||e.querySelector(`h3`)?.textContent||``,url:e.querySelector(`.result_title a`)?.href||e.querySelector(`a`)?.href||``,content:e.querySelector(`.content`)?.textContent||``}));try{let e=await(await t(`POST`,`/quick_summary`,{body:JSON.stringify({q:r,results:o}),timeout:35e3})).json();e.error?this.showError(e.error):this.renderSummary(e)}catch(e){console.error(`Quick Summary error:`,e),this.showError(`Failed to generate summary. Please try again.`)}return!0}async post(e){let t=document.getElementById(`collapse_quick_summary`);t?.addEventListener(`click`,()=>{let e=document.getElementById(`quick_summary`);e?.classList.toggle(`collapsed`);let n=t.querySelector(`svg`);e?.classList.contains(`collapsed`)?n?.classList.add(`rotate-180`):n?.classList.remove(`rotate-180`)}),document.getElementById(`retry_quick_summary`)?.addEventListener(`click`,()=>{this.run()})}renderSummary(e){let t=document.getElementById(`quick_summary`)?.querySelector(`.quick-summary-body`);if(!t)return;let n=this.formatWithCitations(e.summary,e.citations),r=``;e.citations&&e.citations.length>0&&(r=`
        <div class="quick-summary-citations">
          <h5>${(window.translations||{}).Sources||`Sources`}</h5>
          <ul>
            ${e.citations.map((e,t)=>`
              <li>
                <sup><a href="#result-${e.result_index}" class="citation-link">[${e.index}]</a></sup>
                <a href="#result-${e.result_index}" class="citation-title">${this.escapeHtml(e.title)}</a>
              </li>
            `).join(``)}
          </ul>
        </div>
      `),t.innerHTML=`
      <div class="quick-summary-content">
        <div class="quick-summary-text">
          ${n}
        </div>
        ${r}
      </div>
    `,t.querySelectorAll(`.citation-link`).forEach(e=>{e.addEventListener(`click`,t=>{let n=e.getAttribute(`href`);n?.startsWith(`#result-`)&&(t.preventDefault(),document.querySelector(n)?.scrollIntoView({behavior:`smooth`,block:`start`}))})})}formatWithCitations(e,t){if(!t||t.length===0)return this.escapeHtml(e);let n=this.escapeHtml(e);return t.forEach(e=>{let t=RegExp(`\\[${e.index}\\]`,`g`);n=n.replace(t,`<a href="#result-${e.result_index}" class="citation-link">[${e.index}]</a>`)}),n}showError(e){let t=document.getElementById(`quick_summary`)?.querySelector(`.quick-summary-body`);t&&(t.innerHTML=`
      <div class="quick-summary-error" role="alert">
        <p>${this.escapeHtml(e)}</p>
        <button id="retry_quick_summary" type="button">
          ${this.escapeHtml(window.translations?.Retry||`Retry`)}
        </button>
      </div>
    `,document.getElementById(`retry_quick_summary`)?.addEventListener(`click`,()=>{this.run()}))}escapeHtml(e){let t=document.createElement(`div`);return t.textContent=e,t.innerHTML}};export{r as default};
//# sourceMappingURL=zqe8pfDB.min.js.map